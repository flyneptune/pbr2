function initRenderer(){renderer=new THREE.WebGLRenderer({antialias:!0}),canvas=renderer.domElement,renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(canvas),window.addEventListener("resize",doResize,!1),clock=new THREE.Clock,renderer.setClearColor("rgb(0,0,0)"),renderer.shadowMapEnabled=!0,(scene=new THREE.Scene).background=new THREE.Color("rgb(80,80,80)")}function doResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function initHelpers(){(controls=new THREE.OrbitControls(camera,renderer.domElement)).target=new THREE.Vector3(0,50,0)}function showAxes(){var e=new THREE.Geometry,t=new THREE.Vector3(0,0,0);e.vertices.push(t);var a=new THREE.PointsMaterial({color:"cyan",size:10,sizeAttenuation:!1}),n=new THREE.Points(e,a);scene.add(n),drawLine(new THREE.Vector3(0,0,0),new THREE.Vector3(100,0,0),"rgb(255,0,0)"),drawLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0,100,0),"rgb(0,255,0)"),drawLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,100),"rgb(0,0,255)")}function drawLine(e,t,a){var n=new THREE.Geometry;n.vertices.push(e),n.vertices.push(t);var o=new THREE.LineBasicMaterial({color:a,linewidth:2}),r=(new THREE.LineBasicMaterial({color:a,linewidth:2}),new THREE.LineBasicMaterial({color:a,linewidth:2}),new THREE.Line(n,o,THREE.LineStrip));scene.add(r)}function initCamera(){(camera=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.1,4e3)).position.set(150,60,150),camera.lookAt(scene.position),scene.add(camera)}function initLights(){(light=new THREE.DirectionalLight("rgb(255,255,255)",1.5)).castShadow=!0,light.shadowMapWidth=1024,light.shadowMapHeight=1024,light.shadowCameraLeft=-200,light.shadowCameraRight=200,light.shadowCameraBottom=-200,light.shadowCameraTop=200,light.shadowCameraNear=1,light.shadowCameraFar=300,light.position.set(0,150,75),scene.add(light)}function newPointLight(e,t,a,n,o){var r=new THREE.PointLight(n,o,0,2);r.castShadow=!0,r.shadowMapWidth=1024,r.shadowMapHeight=1024,r.shadowCameraLeft=-200,r.shadowCameraRight=200,r.shadowCameraBottom=-200,r.shadowCameraTop=200,r.shadowCameraNear=1,r.shadowCameraFar=3e3,r.position.set(e,t,a),scene.add(r);var i=new THREE.PointLightHelper(r,10);return scene.add(i),r}function initLoadingManager(){var e=document.createElement("div"),t=document.createElement("div"),a=document.createElement("div");e.appendChild(t),e.appendChild(a),document.body.appendChild(e),a.innerHTML="Loading...",e.style="position: absolute; z-index: 500; right:0px; left:0px; top:0px; bottom:0px; margin: auto; width:300px; height:40px; background-color:#555555; border-radius: 4px;",t.style="width:25px; height:40px; background-color:#5E9CE5; border-radius: 4px;",a.style="color:#fff; position: absolute; z-index:2; right:0px; left:0px; top:10px; bottom:0px; width:300px; height:40px; text-align:center;",THREE.DefaultLoadingManager.onStart=function(e,t,a){},THREE.DefaultLoadingManager.onProgress=function(e,n,o){var r=100*n/o;a.innerHTML="Loading: "+Math.round(r)+" %";var i=300*r/100;t.style.width=i+"px"},THREE.DefaultLoadingManager.onLoad=function(){e.style.display="none",assetsLoaded=!0},THREE.DefaultLoadingManager.onError=function(e){console.log("error loading asset "+e)}}function initMaterials(){maxAnisotropy=renderer.getMaxAnisotropy();var e,t,a,n,o,r;e="materials/scuffedCopper/",t=!0,a=1,n=!0,o=1,r=new THREE.Vector2(1,1),scuffedCopperMat=createMaterial(e,r,t,a,n,o,.5,0,0,1),e="materials/roughOldMetal/",t=!0,a=1,n=!0,o=.75,r=new THREE.Vector2(1,1),roughOldMetalMat=createMaterial(e,r,t,a,n,o,.5,0,0,2),e="materials/ceramic/",t=!1,a=0,n=!0,o=1,r=new THREE.Vector2(0,0),ceramicMat=createMaterial(e,r,t,a,n,o,1,0,0,1),e="materials/cupInner/",t=!1,a=0,n=!1,o=0,r=new THREE.Vector2(0,0),cupInnerMat=createMaterial(e,r,t,a,n,o,0,0,0,1),e="materials/cueball8/",t=!1,a=0,n=!0,o=1,r=new THREE.Vector2(0,0),cueball8Mat=createMaterial(e,r,t,a,n,o,1,0,0,1),e="materials/floor/",t=!1,a=0,n=!0,o=.5,r=new THREE.Vector2(1.5,1.5),floorMat=createMaterial(e,r,t,a,n,o,.3,0,0,2.5),e="materials/rock/",t=!1,a=0,n=!1,o=.6,r=new THREE.Vector2(1,1),rockMat=createMaterial(e,r,t,a,n,o,.5,0,0,1),e="materials/statue/",t=!1,a=1,n=!0,o=1,r=new THREE.Vector2(1,1),statueMat=createMaterial(e,r,t,a,n,o,.5,0,0,2)}function createMaterial(e,t,a,n,o,r,i,s,c,l){var p=new THREE.MeshPhysicalMaterial({});return p.reflectivity=i,p.clearCoat=s,p.clearCoatRoughness=c,p.map=(new THREE.TextureLoader).load(e+"albedo.jpg"),p.map.anisotropy=maxAnisotropy,p.map.wrapS=THREE.RepeatWrapping,p.map.wrapT=THREE.RepeatWrapping,p.map.repeat.set(l,l),p.normalMap=(new THREE.TextureLoader).load(e+"normal.jpg"),p.normalMap.anisotropy=maxAnisotropy,p.normalScale=t,p.normalMap.wrapS=THREE.RepeatWrapping,p.normalMap.wrapT=THREE.RepeatWrapping,p.normalMap.repeat.set(l,l),a&&(p.metalnessMap=(new THREE.TextureLoader).load(e+"metalness.jpg"),p.metalnessMap.anisotropy=maxAnisotropy,p.metalnessMap.wrapS=THREE.RepeatWrapping,p.metalnessMap.wrapT=THREE.RepeatWrapping,p.metalnessMap.repeat.set(l,l)),p.metalness=n,o&&(p.roughnessMap=(new THREE.TextureLoader).load(e+"roughness.jpg"),p.roughnessMap.anisotropy=maxAnisotropy,p.roughnessMap.wrapS=THREE.RepeatWrapping,p.roughnessMap.wrapT=THREE.RepeatWrapping,p.roughnessMap.repeat.set(l,l)),p.roughness=r,p}function spawnWorld(){(new THREE.TextureLoader).load("img/skyMap.jpg",function(e){e.mapping=THREE.UVMapping,function(e){var t=new THREE.Mesh(new THREE.SphereBufferGeometry(2e3,64,32),new THREE.MeshBasicMaterial({map:e}));t.scale.x=-1,t.rotation.y=Math.PI/180*150,scene.add(t)}(e)}),spawnFloor(),loader.load("models/cueball8.json",callbackCueball8),loader.load("models/teapot.json",callbackTeapot),loader.load("models/jug.json",callbackJug),loader.load("models/cup.json",callbackCup),loader.load("models/cupInner.json",callbackCupInner),loader.load("models/rock.json",callbackRock),loader.load("models/statue.json",callbackStatue)}function spawnFloor(){var e=new THREE.CylinderGeometry(275,275,2,64),t=floorMat.clone(),a=new THREE.Mesh(e,t);a.castShadow=!1,a.receiveShadow=!0,scene.add(a),a.position.set(0,-1,0),a.rotation.y=Math.PI/180*90;var n=new THREE.CubeCamera(cubeCamNear,cubeCamFar,cubeCamRes);n.renderTarget.texture.minFilter=THREE.LinearMipMapLinearFilter,scene.add(n),a.material.envMap=n.renderTarget.texture,a.material.envMap.anisotropy=maxAnisotropy,a.material.envMapIntensity=1,arCubeCameras.push([a,n]),n.position.copy(a.position)}function spawnTestMesh(){var e=new THREE.SphereGeometry(20,60,60),t=darkMarbleMat.clone(),a=new THREE.Mesh(e,t);a.castShadow=!0,a.receiveShadow=!0,scene.add(a),a.position.set(50,20,50);var n=new THREE.CubeCamera(cubeCamNear,cubeCamFar,cubeCamRes);n.renderTarget.texture.minFilter=THREE.LinearMipMapLinearFilter,scene.add(n),a.material.envMap=n.renderTarget.texture,a.material.envMap.anisotropy=maxAnisotropy,a.material.envMapIntensity=1,arCubeCameras.push([a,n]),n.position.copy(a.position)}function callbackCueball8(e,t){fix(e),e.normalsNeedUpdate=!0,e.verticesNeedUpdate=!0;var a=cueball8Mat.clone(),n=new THREE.Mesh(e,a);n.castShadow=!0,n.receiveShadow=!0,scene.add(n);var o=new THREE.CubeCamera(cubeCamNear,cubeCamFar,cubeCamRes);o.renderTarget.texture.minFilter=THREE.LinearMipMapLinearFilter,scene.add(o),n.material.envMap=o.renderTarget.texture,n.material.envMap.anisotropy=maxAnisotropy,n.material.envMapIntensity=1,arCubeCameras.push([n,o]);n.scale.set(1.4,1.4,1.4),n.position.set(-15,0,55),n.rotation.y=Math.PI/180*10,o.position.copy(n.position),e.computeBoundingBox(),o.position.y=e.boundingBox.max.y/2*1.4,cueball8=n,spawnCueball7()}function spawnCueball7(){var e=cueball8.clone();e.material=cueball8Mat.clone(),e.material.map=(new THREE.TextureLoader).load("materials/cueball7/albedo.jpg"),e.material.map.anisotropy=maxAnisotropy,e.material.map.wrapS=THREE.RepeatWrapping,e.material.map.wrapT=THREE.RepeatWrapping,e.material.map.repeat.set(1,1),e.castShadow=!0,e.receiveShadow=!0,scene.add(e);var t=new THREE.CubeCamera(cubeCamNear,cubeCamFar,cubeCamRes);t.renderTarget.texture.minFilter=THREE.LinearMipMapLinearFilter,scene.add(t),e.material.envMap=t.renderTarget.texture,e.material.envMap.anisotropy=maxAnisotropy,e.material.envMapIntensity=1,arCubeCameras.push([e,t]),t.position.copy(e.position);e.scale.set(1.4,1.4,1.4),e.position.set(115,0,20),e.rotation.y=Math.PI/180*30,t.position.copy(e.position),e.geometry.computeBoundingBox(),t.position.y=e.geometry.boundingBox.max.y/2*1.4,cueball7=e}function callbackTeapot(e,t){fix(e),e.normalsNeedUpdate=!0,e.verticesNeedUpdate=!0;var a=scuffedCopperMat.clone(),n=new THREE.Mesh(e,a);n.castShadow=!0,n.receiveShadow=!0,scene.add(n);var o=new THREE.CubeCamera(cubeCamNear,cubeCamFar,cubeCamRes);o.renderTarget.texture.minFilter=THREE.LinearMipMapLinearFilter,scene.add(o),n.material.envMap=o.renderTarget.texture,n.material.envMap.anisotropy=maxAnisotropy,n.material.envMapIntensity=1,arCubeCameras.push([n,o]);n.scale.set(20,20,20),n.position.set(-60,0,-60),n.rotation.y=Math.PI/180*25,o.position.copy(n.position),e.computeBoundingBox(),o.position.y=e.boundingBox.max.y/2*20,teapot=n}function callbackJug(e,t){fix(e),e.normalsNeedUpdate=!0,e.verticesNeedUpdate=!0;var a=roughOldMetalMat.clone(),n=new THREE.Mesh(e,a);n.castShadow=!0,n.receiveShadow=!0,scene.add(n);var o=new THREE.CubeCamera(cubeCamNear,cubeCamFar,cubeCamRes);o.renderTarget.texture.minFilter=THREE.LinearMipMapLinearFilter,scene.add(o),n.material.envMap=o.renderTarget.texture,n.material.envMap.anisotropy=maxAnisotropy,n.material.envMapIntensity=1,arCubeCameras.push([n,o]);n.scale.set(3,3,3),n.position.set(-70,0,60),n.rotation.y=Math.PI/180*290,o.position.copy(n.position),e.computeBoundingBox(),o.position.y=e.boundingBox.max.y/2*3,jug=n}function callbackCup(e,t){fix(e),e.normalsNeedUpdate=!0,e.verticesNeedUpdate=!0;var a=ceramicMat.clone(),n=new THREE.Mesh(e,a);n.castShadow=!0,n.receiveShadow=!0,scene.add(n);var o=new THREE.CubeCamera(cubeCamNear,cubeCamFar,cubeCamRes);o.renderTarget.texture.minFilter=THREE.LinearMipMapLinearFilter,scene.add(o),n.material.envMap=o.renderTarget.texture,n.material.envMap.anisotropy=maxAnisotropy,n.material.envMapIntensity=1,arCubeCameras.push([n,o]);n.scale.set(2,2,2),n.position.set(40,0,-70),n.rotation.y=Math.PI/180*330,o.position.copy(n.position),e.computeBoundingBox(),o.position.y=e.boundingBox.max.y/2*2,(cup=n).name="cup"}function callbackCupInner(e,t){fix(e),e.normalsNeedUpdate=!0,e.verticesNeedUpdate=!0;var a=cupInnerMat.clone(),n=new THREE.Mesh(e,a);n.castShadow=!0,n.receiveShadow=!0,scene.add(n);var o=new THREE.CubeCamera(cubeCamNear,cubeCamFar,cubeCamRes);o.renderTarget.texture.minFilter=THREE.LinearMipMapLinearFilter,scene.add(o),n.material.envMap=o.renderTarget.texture,n.material.envMap.anisotropy=maxAnisotropy,n.material.envMapIntensity=0,arCubeCameras.push([n,o]);n.scale.set(2,2,2),n.position.set(40,0,-70),n.rotation.y=Math.PI/180*330,o.position.copy(n.position),e.computeBoundingBox(),o.position.y=e.boundingBox.max.y/2*2,(cupInner=n).name="cupInner"}function callbackRock(e,t){fix(e),e.normalsNeedUpdate=!0,e.verticesNeedUpdate=!0;var a=rockMat.clone(),n=new THREE.Mesh(e,a);n.castShadow=!0,n.receiveShadow=!0,scene.add(n);var o=new THREE.CubeCamera(cubeCamNear,cubeCamFar,cubeCamRes);o.renderTarget.texture.minFilter=THREE.LinearMipMapLinearFilter,scene.add(o),n.material.envMap=o.renderTarget.texture,n.material.envMap.anisotropy=maxAnisotropy,n.material.envMapIntensity=1,arCubeCameras.push([n,o]);n.scale.set(3.5,3.5,3.5),n.position.set(0,0,0),n.rotation.y=Math.PI/180*27,o.position.copy(n.position),e.computeBoundingBox(),o.position.y=e.boundingBox.max.y/2*3.5,rock=n}function callbackStatue(e,t){fix(e),e.normalsNeedUpdate=!0,e.verticesNeedUpdate=!0;var a=statueMat.clone(),n=new THREE.Mesh(e,a);n.castShadow=!0,n.receiveShadow=!0,scene.add(n);var o=new THREE.CubeCamera(cubeCamNear,cubeCamFar,cubeCamRes);o.renderTarget.texture.minFilter=THREE.LinearMipMapLinearFilter,scene.add(o),n.material.envMap=o.renderTarget.texture,n.material.envMap.anisotropy=maxAnisotropy,n.material.envMapIntensity=1,arCubeCameras.push([n,o]);n.scale.set(.7,.7,.7),n.position.set(70,0,0),n.rotation.y=Math.PI/180*45,o.position.copy(n.position),e.computeBoundingBox(),o.position.y=e.boundingBox.max.y/2*.7,statue=n}function main(){if(assetsLoaded){if(updateCubeCams){for(var e=0;e<arCubeCameras.length;e++){var t=arCubeCameras[e][0],a=arCubeCameras[e][1];"cup"==t.name?(t.visible=!1,cupInner.visible=!1,a.update(renderer,scene),t.visible=!0,cupInner.visible=!0):(t.visible=!1,a.update(renderer,scene),t.visible=!0)}++bla>2&&(updateCubeCams=!1)}controls.update(),renderer.render(scene,camera)}requestAnimationFrame(main)}function init(){initRenderer(),initCamera(),initLights(),initLoadingManager(),initMaterials(),spawnWorld(),initHelpers(),requestAnimationFrame(main)}THREE.OrbitControls=function(e,t){function a(){return Math.pow(.95,b.zoomSpeed)}function n(e){C.theta-=e}function o(e){C.phi-=e}function r(e){b.object instanceof THREE.PerspectiveCamera?y/=e:b.object instanceof THREE.OrthographicCamera?(b.object.zoom=Math.max(b.minZoom,Math.min(b.maxZoom,b.object.zoom*e)),b.object.updateProjectionMatrix(),x=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),b.enableZoom=!1)}function i(e){b.object instanceof THREE.PerspectiveCamera?y*=e:b.object instanceof THREE.OrthographicCamera?(b.object.zoom=Math.max(b.minZoom,Math.min(b.maxZoom,b.object.zoom/e)),b.object.updateProjectionMatrix(),x=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),b.enableZoom=!1)}function s(e){if(!1!==b.enabled){if(e.preventDefault(),e.button===b.mouseButtons.ORBIT){if(!1===b.enableRotate)return;!function(e){L.set(e.clientX,e.clientY)}(e),M=R.ROTATE}else if(e.button===b.mouseButtons.ZOOM){if(!1===b.enableZoom)return;!function(e){k.set(e.clientX,e.clientY)}(e),M=R.DOLLY}else if(e.button===b.mouseButtons.PAN){if(!1===b.enablePan)return;!function(e){N.set(e.clientX,e.clientY)}(e),M=R.PAN}M!==R.NONE&&(document.addEventListener("mousemove",c,!1),document.addEventListener("mouseup",l,!1),b.dispatchEvent(T))}}function c(e){if(!1!==b.enabled)if(e.preventDefault(),M===R.ROTATE){if(!1===b.enableRotate)return;!function(e){O.set(e.clientX,e.clientY),P.subVectors(O,L);var t=b.domElement===document?b.domElement.body:b.domElement;n(2*Math.PI*P.x/t.clientWidth*b.rotateSpeed),o(2*Math.PI*P.y/t.clientHeight*b.rotateSpeed),L.copy(O),b.update()}(e)}else if(M===R.DOLLY){if(!1===b.enableZoom)return;!function(e){A.set(e.clientX,e.clientY),F.subVectors(A,k),F.y>0?r(a()):F.y<0&&i(a()),k.copy(A),b.update()}(e)}else if(M===R.PAN){if(!1===b.enablePan)return;!function(e){S.set(e.clientX,e.clientY),j.subVectors(S,N),V(j.x,j.y),N.copy(S),b.update()}(e)}}function l(e){!1!==b.enabled&&(document.removeEventListener("mousemove",c,!1),document.removeEventListener("mouseup",l,!1),b.dispatchEvent(w),M=R.NONE)}function p(e){!1===b.enabled||!1===b.enableZoom||M!==R.NONE&&M!==R.ROTATE||(e.preventDefault(),e.stopPropagation(),function(e){e.deltaY<0?i(a()):e.deltaY>0&&r(a()),b.update()}(e),b.dispatchEvent(T),b.dispatchEvent(w))}function d(e){!1!==b.enabled&&!1!==b.enableKeys&&!1!==b.enablePan&&function(e){switch(e.keyCode){case b.keys.UP:V(0,b.keyPanSpeed),b.update();break;case b.keys.BOTTOM:V(0,-b.keyPanSpeed),b.update();break;case b.keys.LEFT:V(b.keyPanSpeed,0),b.update();break;case b.keys.RIGHT:V(-b.keyPanSpeed,0),b.update()}}(e)}function u(e){if(!1!==b.enabled){switch(e.touches.length){case 1:if(!1===b.enableRotate)return;!function(e){L.set(e.touches[0].pageX,e.touches[0].pageY)}(e),M=R.TOUCH_ROTATE;break;case 2:if(!1===b.enableZoom)return;!function(e){var t=e.touches[0].pageX-e.touches[1].pageX,a=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+a*a);k.set(0,n)}(e),M=R.TOUCH_DOLLY;break;case 3:if(!1===b.enablePan)return;!function(e){N.set(e.touches[0].pageX,e.touches[0].pageY)}(e),M=R.TOUCH_PAN;break;default:M=R.NONE}M!==R.NONE&&b.dispatchEvent(T)}}function m(e){if(!1!==b.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===b.enableRotate)return;if(M!==R.TOUCH_ROTATE)return;!function(e){O.set(e.touches[0].pageX,e.touches[0].pageY),P.subVectors(O,L);var t=b.domElement===document?b.domElement.body:b.domElement;n(2*Math.PI*P.x/t.clientWidth*b.rotateSpeed),o(2*Math.PI*P.y/t.clientHeight*b.rotateSpeed),L.copy(O),b.update()}(e);break;case 2:if(!1===b.enableZoom)return;if(M!==R.TOUCH_DOLLY)return;!function(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);A.set(0,o),F.subVectors(A,k),F.y>0?i(a()):F.y<0&&r(a()),k.copy(A),b.update()}(e);break;case 3:if(!1===b.enablePan)return;if(M!==R.TOUCH_PAN)return;!function(e){S.set(e.touches[0].pageX,e.touches[0].pageY),j.subVectors(S,N),V(j.x,j.y),N.copy(S),b.update()}(e);break;default:M=R.NONE}}function E(e){!1!==b.enabled&&(b.dispatchEvent(w),M=R.NONE)}function h(e){e.preventDefault()}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=150,this.maxDistance=250,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI/2+Math.PI/180*10,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=.4,this.enablePan=!1,this.keyPanSpeed=7,this.autoRotate=!0,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return H.phi},this.getAzimuthalAngle=function(){return H.theta},this.reset=function(){b.target.copy(b.target0),b.object.position.copy(b.position0),b.object.zoom=b.zoom0,b.object.updateProjectionMatrix(),b.dispatchEvent(g),b.update(),M=R.NONE},this.update=function(){var t=new THREE.Vector3,a=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),o=a.clone().inverse(),r=new THREE.Vector3,i=new THREE.Quaternion;return function(){var e=b.object.position;return t.copy(e).sub(b.target),t.applyQuaternion(a),H.setFromVector3(t),b.autoRotate&&M===R.NONE&&n(2*Math.PI/60/60*b.autoRotateSpeed),H.theta+=C.theta,H.phi+=C.phi,H.theta=Math.max(b.minAzimuthAngle,Math.min(b.maxAzimuthAngle,H.theta)),H.phi=Math.max(b.minPolarAngle,Math.min(b.maxPolarAngle,H.phi)),H.makeSafe(),H.radius*=y,H.radius=Math.max(b.minDistance,Math.min(b.maxDistance,H.radius)),b.target.add(f),t.setFromSpherical(H),t.applyQuaternion(o),e.copy(b.target).add(t),b.object.lookAt(b.target),!0===b.enableDamping?(C.theta*=1-b.dampingFactor,C.phi*=1-b.dampingFactor):C.set(0,0,0),y=1,f.set(0,0,0),!!(x||r.distanceToSquared(b.object.position)>v||8*(1-i.dot(b.object.quaternion))>v)&&(b.dispatchEvent(g),r.copy(b.object.position),i.copy(b.object.quaternion),x=!1,!0)}}(),this.dispose=function(){b.domElement.removeEventListener("contextmenu",h,!1),b.domElement.removeEventListener("mousedown",s,!1),b.domElement.removeEventListener("wheel",p,!1),b.domElement.removeEventListener("touchstart",u,!1),b.domElement.removeEventListener("touchend",E,!1),b.domElement.removeEventListener("touchmove",m,!1),document.removeEventListener("mousemove",c,!1),document.removeEventListener("mouseup",l,!1),window.removeEventListener("keydown",d,!1)};var b=this,g={type:"change"},T={type:"start"},w={type:"end"},R={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},M=R.NONE,v=1e-6,H=new THREE.Spherical,C=new THREE.Spherical,y=1,f=new THREE.Vector3,x=!1,L=new THREE.Vector2,O=new THREE.Vector2,P=new THREE.Vector2,N=new THREE.Vector2,S=new THREE.Vector2,j=new THREE.Vector2,k=new THREE.Vector2,A=new THREE.Vector2,F=new THREE.Vector2,I=function(){var e=new THREE.Vector3;return function(t,a){e.setFromMatrixColumn(a,0),e.multiplyScalar(-t),f.add(e)}}(),U=function(){var e=new THREE.Vector3;return function(t,a){e.setFromMatrixColumn(a,1),e.multiplyScalar(t),f.add(e)}}(),V=function(){var e=new THREE.Vector3;return function(t,a){var n=b.domElement===document?b.domElement.body:b.domElement;if(b.object instanceof THREE.PerspectiveCamera){var o=b.object.position;e.copy(o).sub(b.target);var r=e.length();r*=Math.tan(b.object.fov/2*Math.PI/180),I(2*t*r/n.clientHeight,b.object.matrix),U(2*a*r/n.clientHeight,b.object.matrix)}else b.object instanceof THREE.OrthographicCamera?(I(t*(b.object.right-b.object.left)/b.object.zoom/n.clientWidth,b.object.matrix),U(a*(b.object.top-b.object.bottom)/b.object.zoom/n.clientHeight,b.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),b.enablePan=!1)}}();b.domElement.addEventListener("contextmenu",h,!1),b.domElement.addEventListener("mousedown",s,!1),b.domElement.addEventListener("wheel",p,!1),b.domElement.addEventListener("touchstart",u,!1),b.domElement.addEventListener("touchend",E,!1),b.domElement.addEventListener("touchmove",m,!1),window.addEventListener("keydown",d,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}});var scene,camera,light,renderer,canvas,controls,cameraAndLight,clock,stats,maxAnisotropy,scuffedCopperMat,roughOldMetalMat,cueball8Mat,ceramicMat,cupInnerMat,floorMat,rockMat,statueMat,cueball8,teapot,jug,cup,cupInner,cueball7,rock,statue,assetsLoaded=!1,loader=new THREE.JSONLoader,cubeCamNear=1,cubeCamFar=2100,cubeCamRes=512,updateCubeCams=!0,arCubeCameras=[],bla=0;